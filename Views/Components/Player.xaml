<UserControl x:Class="Vibra_DesktopApp.Views.Components.Player"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:Vibra_DesktopApp.Views.Components"
             xmlns:fa="clr-namespace:FontAwesome.Sharp;assembly=FontAwesome.Sharp"
             mc:Ignorable="d" 
             d:DesignHeight="76" d:DesignWidth="1600">
    
    <Grid Background="Black">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="2*"/>
            <ColumnDefinition Width="5*"/>
            <ColumnDefinition Width="2*"/>
        </Grid.ColumnDefinitions>

        <!-- ================= LEFT: SONG INFO ================= -->
        <StackPanel Grid.Column="0"
                    Orientation="Horizontal"
                    VerticalAlignment="Center" Margin="20 0 0 0">

            <!-- Thumbnail -->
            <Border Width="52"
                    Height="52"
                    CornerRadius="26">
                <Border.Background>
                    <ImageBrush ImageSource="{Binding SongManager.CurrentTrack.thumbnail_path}" Stretch="UniformToFill"/>
                </Border.Background>
            </Border>

            <!-- Song title + artist -->
            <StackPanel VerticalAlignment="Center" Margin="16 0 0 0">
                <TextBlock Text="{Binding SongManager.CurrentTrack.name}"
                           Foreground="White"
                           FontWeight="SemiBold"
                           FontSize="14"
                           TextTrimming="CharacterEllipsis"/>

                <TextBlock Text="{Binding SongManager.CurrentTrack.author.name}"
                           Foreground="#AAAAAA"
                           FontSize="12"/>
            </StackPanel>
        </StackPanel>

        <!-- ================= CENTER: CONTROLS ================= -->
        <StackPanel Grid.Column="1"
                    VerticalAlignment="Center"
                    HorizontalAlignment="Center">

            <!-- Control buttons -->
            <StackPanel Orientation="Horizontal"
                        HorizontalAlignment="Center">

                <fa:IconBlock Icon="Random"
                              Foreground="White"
                              FontSize="16"
                              Margin="12,0"/>

                <fa:IconBlock Icon="StepBackward"
                              Foreground="White"
                              FontSize="18"
                              Margin="12,0"/>

                <!-- Play button -->

                <Button Width="40"
                        Height="40"
                        Background="White"
                        Margin="20 0 20 4"
                        Style="{StaticResource IconButtonStyle}"
                        Command="{Binding PlayOrPauseCommand}"
                        >

                    <fa:IconBlock Icon="{Binding SongManager.IsPlaying, Converter={StaticResource BoolToIconConverter}}"
                                  Foreground="Black"
                                  FontSize="18"
                                  HorizontalAlignment="Center"
                                  VerticalAlignment="Center"/>
                </Button>

                <fa:IconBlock Icon="StepForward"
                              Foreground="White"
                              FontSize="18"
                              Margin="12,0"/>

                <fa:IconBlock Icon="RedoAlt"
                              Foreground="White"
                              FontSize="16"
                              Margin="12,0"/>
            </StackPanel>

            <!-- Progress bar -->
            <Grid Width="420"
                  VerticalAlignment="Center">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBlock Text="{Binding SongManager.CurrentTime, Converter={StaticResource TimeConverter}}"
                           Foreground="#AAAAAA"
                           FontSize="11"
                           VerticalAlignment="Center"/>

                <Slider Grid.Column="1"
                        Minimum="0"
                        Maximum="{Binding SongManager.Duration}"
                        Value="{Binding SongManager.CurrentTime, Mode=TwoWay}"
                        Margin="8,0"
                        Height="20"
                        VerticalAlignment="Center"
                        Foreground="White"
                        Background="Wheat">
                    <Slider.Template>
                        <ControlTemplate TargetType="Slider">
                            <Grid VerticalAlignment="Center">
                                <Track x:Name="PART_Track" Height="10">

                                    <!-- PHẦN ĐÃ CHẠY -->
                                    <Track.DecreaseRepeatButton>
                                        <RepeatButton IsHitTestVisible="False"
                                                      Height="4"
                                                      Background="#BC4D15"
                                                      BorderThickness="0">
                                            <RepeatButton.Template>
                                                <ControlTemplate TargetType="RepeatButton">
                                                    <Border Background="{TemplateBinding Background}" CornerRadius="2"/>
                                                </ControlTemplate>
                                            </RepeatButton.Template>
                                        </RepeatButton>
                                    </Track.DecreaseRepeatButton>

                                    <!-- PHẦN CHƯA CHẠY -->
                                    <Track.IncreaseRepeatButton>
                                        <RepeatButton IsHitTestVisible="False"
                                                      Height="4"
                                                      Background="#FFE5D6"
                                                      BorderThickness="0">
                                            <RepeatButton.Template>
                                                <ControlTemplate TargetType="RepeatButton">
                                                    <Border Background="{TemplateBinding Background}" CornerRadius="2"/>
                                                </ControlTemplate>
                                            </RepeatButton.Template>
                                        </RepeatButton>
                                    </Track.IncreaseRepeatButton>

                                    <!-- THUMB -->
                                    <Track.Thumb>
                                        <Thumb Width="10"
                                               Height="10"
                                               Background="#BC4D15"
                                               VerticalAlignment="Center">
                                            <Thumb.Template>
                                                <ControlTemplate TargetType="Thumb">
                                                    <Ellipse Fill="{TemplateBinding Background}"/>
                                                </ControlTemplate>
                                            </Thumb.Template>
                                        </Thumb>
                                    </Track.Thumb>

                                </Track>
                            </Grid>
                        </ControlTemplate>
                    </Slider.Template>
                </Slider>

                <TextBlock Grid.Column="2"
                           Text="{Binding SongManager.Duration, Converter={StaticResource TimeConverter}}"
                           Foreground="#AAAAAA"
                           FontSize="11"
                           VerticalAlignment="Center"/>
            </Grid>
        </StackPanel>

        <!-- ================= RIGHT: ACTIONS + VOLUME ================= -->
        <StackPanel Grid.Column="2"
                    Orientation="Horizontal"
                    VerticalAlignment="Center"
                    HorizontalAlignment="Right">

            <Button Background="Transparent"
                    BorderThickness="0" Margin="10 0">
                <fa:IconBlock Icon="VolumeUp"
                              Foreground="White"
                              FontSize="16"
                              Margin="4 0"/>
            </Button>

            <Slider Width="90"
                    Height="10"
                    VerticalAlignment="Center"
                    Margin="0 0 16 0"
                    Background="Gray">
                <Slider.Template>
                    <ControlTemplate TargetType="Slider">
                        <Grid VerticalAlignment="Center">
                            <Track x:Name="PART_Track" Height="10">

                                <!-- PHẦN ĐÃ CHẠY -->
                                <Track.DecreaseRepeatButton>
                                    <RepeatButton IsHitTestVisible="False"
                                  Height="4"
                                  Background="#BC4D15"
                                  BorderThickness="0">
                                        <RepeatButton.Template>
                                            <ControlTemplate TargetType="RepeatButton">
                                                <Border Background="{TemplateBinding Background}" CornerRadius="2"/>
                                            </ControlTemplate>
                                        </RepeatButton.Template>
                                    </RepeatButton>
                                </Track.DecreaseRepeatButton>

                                <!-- PHẦN CHƯA CHẠY -->
                                <Track.IncreaseRepeatButton>
                                    <RepeatButton IsHitTestVisible="False"
                                  Height="4"
                                  Background="Gray"
                                  BorderThickness="0">
                                        <RepeatButton.Template>
                                            <ControlTemplate TargetType="RepeatButton">
                                                <Border Background="{TemplateBinding Background}" CornerRadius="2"/>
                                            </ControlTemplate>
                                        </RepeatButton.Template>
                                    </RepeatButton>
                                </Track.IncreaseRepeatButton>

                                <!-- THUMB -->
                                <Track.Thumb>
                                    <Thumb Width="10"
                           Height="10"
                           Background="#BC4D15"
                           VerticalAlignment="Center">
                                        <Thumb.Template>
                                            <ControlTemplate TargetType="Thumb">
                                                <Ellipse Fill="{TemplateBinding Background}"/>
                                            </ControlTemplate>
                                        </Thumb.Template>
                                    </Thumb>
                                </Track.Thumb>

                            </Track>
                        </Grid>
                    </ControlTemplate>
                </Slider.Template>
            </Slider>

            <Button Background="Transparent"
                    BorderThickness="0" Margin="10 0"
                    Command="{Binding TogglePanelCommand}">
                <fa:IconBlock Icon="List"
                              Foreground="White"
                              FontSize="16"
                              Margin="4 0"/>
            </Button>

            <Button Background="Transparent"
                    BorderThickness="0" Margin="10 0"
                    Command="{Binding TogglePanelCommand}">
                <fa:IconBlock Icon="TabletScreenButton"
                              Foreground="White"
                              FontSize="16"
                              Margin="4 0"/>
            </Button>

            <Button Background="Transparent"
                    BorderThickness="0" Margin="10 0 20 0">
                <fa:IconBlock Icon="Expand"
                              Foreground="White"
                              FontSize="24"
                              Margin="4 0"/>
            </Button>
        </StackPanel>

    </Grid>
</UserControl>
